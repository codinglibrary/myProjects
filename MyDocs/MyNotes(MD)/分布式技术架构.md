### 背景

​		（内容缺失）

### 架构的演变过程

阶段一：初始阶段架构（单机）

阶段二：应用服务器和数据库服务器分离，使用缓存改善性能

阶段三：应用服务器集群

阶段四：数据库压力变大，数据库读写分离

阶段五：使用搜索引擎缓解读库的压力

阶段六：反向代理和CDN加速，引入缓存机制缓解数据库的压力

【以上阶段称为传统】

阶段七：数据库的水平/垂直拆分，分布式文件系统和分布式数据库

阶段八：应用的拆分，如何拆分？服务化架构

分布式架构全景：![img](R:\projects.qingjiu\images\notes\分布式架构全景图.jpg) 

### 主流的分布式架构

- SOA架构

SOA 全称是: Service Oriented Architecture，中文释义为 “面向服务的架构”，它是一种设计理念，其中包含多个服务， 服务之间通过相互依赖最终提供一系列完整的功能。各个服务通常以独立的形式部署运行，服务之间 通过网络进行调用。架构图如下

![img](R:\projects.qingjiu\images\notes\SOA架构.jpg) 

- ESB (企业服务总线)

跟 SOA 相提并论的还有一个概念叫ESB(企业服务总线)，简单来说 ESB 就是一根管道，用来连接各个服务节点。ESB的存在是为了集成基于不同协议的不同服务，ESB 做了消息的转化、解释以及路由的工作，以此来让不同的服务互联互通，架构图如下。

![img](R:\projects.qingjiu\images\notes\ESB架构图.jpg) 

- 微服务（MicroServices）架构

微服务架构和 SOA 架构非常类似,微服务只是 SOA 的升华，只不过微服务架构强调的是“业务需要彻底的组件化及服务化”，原先单个业务系统会被拆分为多个可以独立开发、设计、部署运行的小应用。这些小应用间通过服务化完成交互和集成。 组件表示的就是一个可以独立更换和升级的单元，就像 PC 中 的 CPU、内存、显卡、硬盘一样，独立且可以更换升级而不影响其他单元。若我们把 PC 中的各个组件以服务的方式构建，那么这台 PC 只需要维护主板（可以理解为ESB）和一些必要的外部设备就可以。CPU、内存、硬盘等都是以组件方式提供服务，例如PC 需要调用 CPU 做计算处理，只需知道 CPU 这个组件的地址就可以了。

### 分布式架构的基本理论

#### CAP理论

 一个分布式系统不可能同时满足一致性(C:Consistency)、可用性(A:Availability)及分区容错性(P:Partition tolerance) 这三个基本要求。CAP 并不是一个普适性原理和指导思想，它仅适用于原子读写的 NoSql 场景中，并不适用于数据库系统。

CAP原理告诉我们，C,A,P三个方面同时只能满足两个，不可能同时满足。然而对于分布式系统而言，分区容错性是基本要求,系统根据自身方面的要求需要对可用性和一致性做取舍.对于网站服务来说, 可用性可能价值更高, 所以一般网站都会选择作为可用性放弃一致性. 而对于数据库系统, 数据一致性是重中之重, 所以数据库系统追求的是一致性放弃的是可用性.

- 一致性 : 所有节点上的数据时刻保持同步

- 可用性 : 每个请求都能接收一个响应，无论响应成功或失败

- 分区容错 : 系统应该持续提供服务，即使系统内部(某个节点分区)有消息丢失。比如交换机失败、网址网络被分成几个子网，形成脑裂、服务器发生网络延迟或死机，导致某些 server 与集群中的其他机器失去联系。

#### BASE理论

eBay 尝试了另外一条完全不同的路，放宽了数据库事务的 ACID 要求，提出了一套名为 BASE 的新准则。BASE 全称为 Basically Available,Soft-state,Eventually Consistent. 系统基本可用、软状态、数据最终一致性。相对于 CAP 来说，它大大降低了我们对系统的要求。既然无法做到强一致性，然而每个应用都可以根据自身的业务特点，采用适当的方式来使系统达到最终一致性。BASE理论的三个要点为:

- 基本可用（Basically Available）当系统出现故障时,损失部分功能的前提下保障系统基本功能的可用性，相比较正常的系统而言, 可能是响应时间的增大, 亦或者是功能的降级, 如电商系统大促秒杀期间为保障系统稳定导致部分服务接口降级.

- 软状态（Soft State）软状态指的是：允许系统中的数据存在中间状态，并认为该状态不影响系统的整体可用性，即允许系统在多个不同节点的数据副本存在数据延时。相对于原子性的强一致硬状态而言，我们称之为软状态。

- 最终一致性（Eventually Consistent）软状态不可能一直是软状态，必须有个时间期限。在期限过后，应当保证所有副本保持数据一致性，从而达到数据的最终一致性。这个时间期限取决于网络延时、系统负载、数据复制方案设计等等因素。

### 分布式架构的基本概念

- 分布式架构的关键技术

- 分布式系统的安全控制

- 分布式系统的可扩展性

- 分布式系统的透明性

### 分布式系统的意义

之所以要发展分布式系统架构，是因为单机系统存在着如下诸多缺点等待被解决：

- 升级单机处理能力的性价比越来越低

- 单机处理能力存在瓶颈

- 稳定性和可用性这两个指标很难达到

### 分布式系统的优势

- 资源共享

- 性能价格比高

- 采用模块化结构

- 可靠性高

- 响应速度快

### 分布式技术架构关键技术介绍-DevOps

​		（内容缺失）

### 可视化架构管理和治理

- 可视化架构管理 ：领域分层、领域分域、应用管理

- 架构巡检和治理：架构巡检平台（通过定期任务巡检的模式，发现异常和待优化点，并推动治理）；巡检内容（服务闭环检测、核心服务检测、冗余服务检测）

### 容器技术

- 新的应用打包方式将整个应用的运行时打包，构建标准化运维环境

- 跨平台、可移植并且简单易用；提高资源率

- 为开发者与系统管理员设计 ；用于构建、发布和运行分布式应用

### 分布式架构还在继续演进

- 逐步业务与技术分离，架构弹性标准化，业务敏捷

- “云机房”

- “云就绪”

- “云原生”