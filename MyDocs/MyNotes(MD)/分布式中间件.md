### REDIS

#### 缓存介绍

1、缓存定义

2、缓存的存在形式：本地缓存，分布式缓存

3、缓存带来的好处：

- 性能提升：减少交互的通讯量，减少处理次数

- 系统稳定性提升：较少频繁访问带来的资源损耗

- 系统可靠性提升：数据库宕机的极端情况，可以临时提供服务

4、 分布式缓存产品

- redis

- TAIR：淘宝做的，蚂蚁金服。redis的增强版

- memcached

- VMware Tanzu GemFire：12306用的产品，偏向于关系型数据库，性能是里面最差的

#### redis是什么？

是基于键值对的NoSQL数据库

（1）优点

（2）缺点：数据大小限制、内存限制、CPU使用率

（3）高性能：基于内存（纯内存操作，避免了大量的磁盘IO操作）； 单线程（单线程处理请求指令）；IO多路复用（多个网络连接服用一个线程）

（4）数据类型丰富：

七个基本：**String**\\**Hash**\\**List**\\**Set**\\Zset（Set的增强）\Stream

三个扩展：Bitmaps（位图）\Hyperloglog（基数统计）\GEO（地理位置）

（5）持久化方式：

***RDB***：可压缩的二进制数据文件；指令或策略一次生成；无法存储增量数据，数据丢失风险大；创建的**文件较小，恢复数据也较快**

***AOF***：比RDB**更可靠**、更可控，但数据量更大。文本格式文件；日志追加的形式生成，保存增量数据，数据丢失少；AOF文件经常要重写；文件内容可读性较强

***RDB+AOF***：结合了RDB和AOF的优势，支持向下兼容

（6）主从架构

带来了一些问题：主节点故障需要人工干预；客户端修改IP后需要重启，等。

（7）哨兵架构

哨兵的功能：监控、故障转移、通知、提供集群信息。

（8）集群架构

集群的特点：gossip协议通讯、自动故障转移、虚拟槽分区、动态扩缩容。

#### 缓存开发

1、redis的边界问题 

2、危险指令

3、禁用的指令：

- keys,flushall,flushdb,monitor指令，有遍历的需求可以使用

- scan,hacan,sscan,zscan代替keys

4、慎用的指令

- String:del,mset...

- Hash:hgetall,hkeys,hvals...

- Set:smembers,sinter...

- ...

5、BigKey

6、双写问题

7、先删除缓存，再更新DB

8、Read/Write Through：该套路是把更新数据库的操作由缓存自己代理了，所以对于应用层来说，后端就是一个单一的存储

9、缓存击穿和雪崩

### MQ（消息队列）

Message Queue

1、认识消息队列：分布式系统间的通讯方式（同步 -> rpc远程调用；异步 -> mq调用）

2、能解决什么问题？

- 异步处理

- 系统解耦

- 流量削峰

- 日志收集

- 分布式事务补偿

3、分布式缓存产品

- APACHE ACTIVEMQ

- kafka：A distributed streaming platform

- RabbitMQ

- Apache RocketMQ

4、顺序消费问题