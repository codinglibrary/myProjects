[TOC]

### 数据库发展历史

从两个大类来看，

**传统关系型数据库**：Oracle、DB2、MySQL

**非关系型数据库**：key-value数据库（redis）、列式数据库（Hbase）、文档型数据库（MongoDB）、图数据库（InfoGrid）、分布式数据库

### 什么是分布式数据库

**逻辑上整体，物理上分散存储**

类别1：数据库中间件+开源数据库

> 什么是数据库中间件？
>
> 在应用与数据库之间加一个数据库中间件进行路由，解决业务剧烈增长引起的一些性能问题（如：单个表数据量太大、单个库数据量太大、单台数据量服务器压力很大、读写速度遇到瓶颈）。

类别2：天然分布式数据库

### 分库分表

**数据分片**

垂直（纵深）分片

> 按照不同的表（或者schema）切分到不同的数据库（主机）上

水平（横向）分片

> 将同一个表中的数据按照某种规则拆分到多台数据库（主机）上

### Mycat-简介

基于阿里开源的Cobar（被淘汰下来的一个产品）而发展起来的数据库中间件

**关键特性：**

1. 支持分库分表、读写分离

2. 支持QSQL92标准，支持sum，count，max等常用的聚合函数
3. 遵循MySQL原生协议，可以当成MySQL使用
4. 支持全局序列号
5. 后端JDBC方式支持Oracle、DB2、SQL Server、mongodb、MySQL等

### Mycat-架构

- 监控&管理

- MySQL Protocol通信层（NIO/AIO）

- 应用层接口

- 【SQL解析组件、SQL优化组件、SQL路由组件】，【ORDER BY排序】，GROUP BY聚合】，【结果集合并】

- SQL执行组件

- 数据库连接池

- JDBC DRIVER（BIO）

### Mycat-高可用

名词：VIP（virtual ip）、keepalived（进行健康状态检查）、lvs

### ShardingSphere-JDBC

采用在JDBC层扩展分库分表，支持读写分离。以jar形式提供服务的轻量型组件...

### ShardingSphere-Proxy

支持XA强一致事务，同时也支持分布式事务API接口...

### 分布式事务

就是一个数据库事务在多个数据库实例上面执行，并且多个实例上面都执行了写入(insert/updata/delete)操作

- 两阶段提交算法：实现统一的数据库事务的ACID保障

- XA：标准的两阶段提交协议

- Prepare阶段：Coordinator给所有的Participant发送prepare请求，P...将Redo...

- Commit阶段

- TCC：柔性的分布式事务解决方案，可用于解决跨库操作的数据一致性问题；根据服务化的两阶段编程模型，可以分为：Try、Confirm、Cancel三个方法。 ©阿里巴巴-蚂蚁金服

- TCC并发控制

### TDSQL

是腾讯公司研发的基于mariaDB的分布式数据库。

架构：

​		腾讯云网关、网络安全服务、SQL/APL、数据传输工具

​		分片（Sharding）

​		节点组（SET）

​		数据节点（DB）

​		SQL Engine（proxy）

​		调度集群（TSchedule）、决策集群（TZooKeeper）

高度兼容MYSQL：

​		关系型实例（noshard）：可以理解为MySQL/MariaDB主从高可用架构的数据库

​		分布式实例（shard）

高可用保障机制：

​		（内容缺失）

故障自动转移与恢复：

​		1、主DB降级为从机

​		2、参与选举的从机上报最新的binlog文件便宜

​		3、scheduler收到binlog点后，选择出binlog最大的节点

​		4、重建主备关系

​		5、修改路由

​		6、请求发给新的主机

弹性扩展

分布式实例扩容

读写分离

​		1、代码添加注释/*slave*/

​		2、添加只读账号

​		3、只读节点（不参与高可用）

分布式事务

容灾（两地三中心）

### OceanBase

是蚂蚁金服自主研发的金融级分布式数据库，是一个个无共享的分布式数据库，可运行在普通PC服务器组成的集群之上，具备可扩展、高可用、高性能、低成本等特性。核心优势主要是持续可用及准内存数据库，底层实现了Paxos复制协议，可以容忍单IDC故障，另外，OceanBase还借鉴了内存数据库（redis）的高性能设计，性能更高。 

架构：

​		一般部署三个副本（Zone），每个副本由多台物理机器（OBServer）组成。每个Zone包含两种角色：总控服务以及分区服务。每个分区服务管理多个分区，结构上分为两层：SQL引擎以及存储引擎。

资源的逻辑表示：

​		（内容缺失）

数据分片：

​		水平拆分方式：分库分表与分区（动词），二选一或者混合搭配

​		分区（名词）是表的子集。分区表有多个分区，普通表只有一个分区。

​		分区策略：HASH/KEY/RANGE/LIST

​		二级分区：hash-hash/key-key/range-rage/hash-key/hash-range

数据分布：

​		分区是表的子集

​		分区三副本：主副本，leader，提供读写；两个备副本，follower，不提供读写

​		副本同步：基于paxos协议实现数据强一致

​		每个副本都被分散在不同的节点上以保证高可用

存储引擎：

​		OceanBase将当前更新的动态数据存入内存，这部分数据被称为MemTable，存量的基线数据存放在磁盘，被称为SSTable。



其他关键知识点（内容缺失）：

每日合并

弹性扩展

读写分离

高可用机制

Paxos协议

宕机流程

容灾（两地三中心）

● 云平台